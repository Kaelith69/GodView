<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 820 440" width="820" height="440" role="img" aria-label="GodView Data Flow Diagram">
  <defs>
    <radialGradient id="dfBg" cx="50%" cy="10%" r="80%">
      <stop offset="0%" stop-color="#1a1033"/>
      <stop offset="100%" stop-color="#09090b"/>
    </radialGradient>
    <marker id="dfArr" markerWidth="9" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 9 3.5, 0 7" fill="#52525b"/>
    </marker>
    <marker id="dfArrRose" markerWidth="9" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 9 3.5, 0 7" fill="#f43f5e"/>
    </marker>
    <marker id="dfArrViolet" markerWidth="9" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 9 3.5, 0 7" fill="#8b5cf6"/>
    </marker>
    <marker id="dfArrAmber" markerWidth="9" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 9 3.5, 0 7" fill="#fb923c"/>
    </marker>
    <marker id="dfArrGreen" markerWidth="9" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 9 3.5, 0 7" fill="#10b981"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="820" height="440" rx="16" fill="url(#dfBg)"/>

  <!-- Title -->
  <text x="410" y="28" font-family="system-ui, sans-serif" font-size="11" fill="#52525b" text-anchor="middle" font-weight="600" letter-spacing="2.5">GODVIEW — DATA FLOW PIPELINE</text>

  <!-- ──── AUTH PATH (top lane) ──── -->
  <text x="22" y="68" font-family="system-ui" font-size="10" fill="#fb923c" font-weight="600" letter-spacing="1.5">AUTH PATH</text>

  <!-- Step 1: init() -->
  <rect x="20" y="76" width="110" height="44" rx="8" fill="rgba(251,146,60,0.12)" stroke="#fb923c" stroke-width="1.5"/>
  <text x="75" y="96" font-family="system-ui" font-size="11" fill="#fb923c" text-anchor="middle" font-weight="700">init()</text>
  <text x="75" y="112" font-family="monospace" font-size="9" fill="#52525b" text-anchor="middle">entry point</text>

  <!-- Arrow → checkAuth -->
  <line x1="130" y1="98" x2="162" y2="98" stroke="#fb923c" stroke-width="1.5" marker-end="url(#dfArrAmber)"/>

  <!-- Step 2: checkAuth -->
  <rect x="164" y="76" width="130" height="44" rx="8" fill="rgba(251,146,60,0.10)" stroke="#fb923c" stroke-width="1.5"/>
  <text x="229" y="96" font-family="system-ui" font-size="11" fill="#fb923c" text-anchor="middle" font-weight="700">checkAuth()</text>
  <text x="229" y="112" font-family="monospace" font-size="9" fill="#52525b" text-anchor="middle">sessionStorage read</text>

  <!-- Decision diamond -->
  <polygon points="336,98 358,76 380,98 358,120" fill="rgba(251,146,60,0.08)" stroke="#fb923c" stroke-width="1.5"/>
  <text x="358" y="103" font-family="system-ui" font-size="9" fill="#fb923c" text-anchor="middle">auth?</text>

  <!-- Arrow: YES → renderDashboard -->
  <line x1="380" y1="98" x2="415" y2="98" stroke="#10b981" stroke-width="1.5" marker-end="url(#dfArrGreen)"/>
  <text x="396" y="93" font-family="system-ui" font-size="8.5" fill="#10b981">YES</text>

  <rect x="417" y="76" width="155" height="44" rx="8" fill="rgba(16,185,129,0.10)" stroke="#10b981" stroke-width="1.5"/>
  <text x="494" y="96" font-family="system-ui" font-size="11" fill="#34d399" text-anchor="middle" font-weight="700">renderDashboard()</text>
  <text x="494" y="112" font-family="monospace" font-size="9" fill="#52525b" text-anchor="middle">builds DOM skeleton</text>

  <!-- Arrow: NO → renderLogin -->
  <line x1="358" y1="120" x2="358" y2="152" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#dfArrRose)"/>
  <text x="364" y="142" font-family="system-ui" font-size="8.5" fill="#f43f5e">NO</text>

  <rect x="300" y="154" width="116" height="44" rx="8" fill="rgba(244,63,94,0.10)" stroke="#f43f5e" stroke-width="1.5"/>
  <text x="358" y="174" font-family="system-ui" font-size="11" fill="#fb7185" text-anchor="middle" font-weight="700">renderLogin()</text>
  <text x="358" y="190" font-family="monospace" font-size="9" fill="#52525b" text-anchor="middle">login screen HTML</text>

  <!-- Arrow: handleLogin → sessionStorage write -->
  <line x1="416" y1="176" x2="460" y2="176" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#dfArrRose)"/>
  <text x="436" y="170" font-family="monospace" font-size="8.5" fill="#52525b">password ✓</text>

  <rect x="462" y="154" width="140" height="44" rx="8" fill="rgba(244,63,94,0.08)" stroke="#f43f5e" stroke-width="1"/>
  <text x="532" y="174" font-family="system-ui" font-size="10" fill="#fb7185" text-anchor="middle">sessionStorage write</text>
  <text x="532" y="190" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">godview_auth_&lt;id&gt; = '1'</text>

  <!-- Arrow from sessionStorage write back up to renderDashboard -->
  <line x1="532" y1="154" x2="532" y2="130" stroke="#f43f5e" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#dfArrRose)"/>
  <line x1="532" y1="120" x2="494" y2="120" stroke="#f43f5e" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- ──── DATA PATH (middle lane) ──── -->
  <line x1="20" y1="218" x2="800" y2="218" stroke="rgba(82,82,91,0.25)" stroke-width="1" stroke-dasharray="6,4"/>
  <text x="22" y="237" font-family="system-ui" font-size="10" fill="#8b5cf6" font-weight="600" letter-spacing="1.5">DATA PATH</text>

  <!-- Step: refreshData -->
  <rect x="20" y="246" width="130" height="44" rx="8" fill="rgba(139,92,246,0.12)" stroke="#8b5cf6" stroke-width="1.5"/>
  <text x="85" y="266" font-family="system-ui" font-size="11" fill="#a78bfa" text-anchor="middle" font-weight="700">refreshData()</text>
  <text x="85" y="282" font-family="monospace" font-size="9" fill="#52525b" text-anchor="middle">triggered by init/refresh</text>

  <!-- Arrow → fetchData -->
  <line x1="150" y1="268" x2="182" y2="268" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#dfArrViolet)"/>

  <!-- fetchData decision -->
  <rect x="184" y="246" width="115" height="44" rx="8" fill="rgba(139,92,246,0.10)" stroke="#8b5cf6" stroke-width="1.5"/>
  <text x="241" y="266" font-family="system-ui" font-size="11" fill="#a78bfa" text-anchor="middle" font-weight="700">fetchData()</text>
  <text x="241" y="282" font-family="monospace" font-size="9" fill="#52525b" text-anchor="middle">router</text>

  <!-- Branch: fetchDataFn? YES -->
  <line x1="299" y1="256" x2="335" y2="246" stroke="#52525b" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#dfArr)"/>
  <text x="316" y="250" font-family="system-ui" font-size="8" fill="#71717a">custom fn</text>

  <rect x="337" y="232" width="130" height="36" rx="8" fill="rgba(37,99,235,0.10)" stroke="#2563eb" stroke-width="1"/>
  <text x="402" y="248" font-family="system-ui" font-size="10" fill="#60a5fa" text-anchor="middle">fetchDataFn()</text>
  <text x="402" y="261" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">your async function</text>

  <!-- Branch: mock data NO -->
  <line x1="299" y1="278" x2="335" y2="288" stroke="#52525b" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#dfArr)"/>
  <text x="316" y="289" font-family="system-ui" font-size="8" fill="#71717a">no fn</text>

  <rect x="337" y="276" width="130" height="36" rx="8" fill="rgba(82,82,91,0.12)" stroke="#52525b" stroke-width="1"/>
  <text x="402" y="292" font-family="system-ui" font-size="10" fill="#a1a1aa" text-anchor="middle">generateMockData()</text>
  <text x="402" y="305" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">50 synthetic events</text>

  <!-- Both paths merge → state.data -->
  <line x1="467" y1="250" x2="520" y2="268" stroke="#52525b" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#dfArr)"/>
  <line x1="467" y1="294" x2="520" y2="276" stroke="#52525b" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#dfArr)"/>

  <rect x="522" y="246" width="120" height="44" rx="8" fill="rgba(244,63,94,0.10)" stroke="#f43f5e" stroke-width="1.5"/>
  <text x="582" y="266" font-family="system-ui" font-size="11" fill="#fb7185" text-anchor="middle" font-weight="700">state.data[ ]</text>
  <text x="582" y="282" font-family="monospace" font-size="9" fill="#52525b" text-anchor="middle">in-memory store</text>

  <!-- Arrow → render() -->
  <line x1="642" y1="268" x2="676" y2="268" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#dfArrRose)"/>

  <rect x="678" y="246" width="120" height="44" rx="8" fill="rgba(244,63,94,0.10)" stroke="#f43f5e" stroke-width="1.5"/>
  <text x="738" y="266" font-family="system-ui" font-size="11" fill="#fb7185" text-anchor="middle" font-weight="700">render()</text>
  <text x="738" y="282" font-family="monospace" font-size="9" fill="#52525b" text-anchor="middle">stats + filter + DOM</text>

  <!-- ──── RENDER PATH (bottom lane) ──── -->
  <line x1="20" y1="312" x2="800" y2="312" stroke="rgba(82,82,91,0.25)" stroke-width="1" stroke-dasharray="6,4"/>
  <text x="22" y="332" font-family="system-ui" font-size="10" fill="#10b981" font-weight="600" letter-spacing="1.5">OUTPUT PATH</text>

  <!-- render() → search filter -->
  <line x1="738" y1="290" x2="738" y2="336" stroke="#f43f5e" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#dfArrRose)"/>
  <line x1="738" y1="340" x2="650" y2="340" stroke="#f43f5e" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#dfArrRose)"/>

  <rect x="530" y="320" width="118" height="40" rx="8" fill="rgba(244,63,94,0.08)" stroke="#f43f5e" stroke-width="1"/>
  <text x="589" y="338" font-family="system-ui" font-size="10" fill="#fb7185" text-anchor="middle">Search Filter</text>
  <text x="589" y="352" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">state.searchQuery</text>

  <!-- 4 output boxes -->
  <line x1="528" y1="340" x2="475" y2="340" stroke="#52525b" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#dfArr)"/>

  <rect x="376" y="320" width="97" height="40" rx="8" fill="rgba(16,185,129,0.09)" stroke="#10b981" stroke-width="1"/>
  <text x="424" y="337" font-family="system-ui" font-size="10" fill="#34d399" text-anchor="middle">Map Markers</text>
  <text x="424" y="351" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">Leaflet L.marker</text>

  <rect x="270" y="320" width="100" height="40" rx="8" fill="rgba(244,63,94,0.08)" stroke="#f43f5e" stroke-width="1"/>
  <text x="320" y="337" font-family="system-ui" font-size="10" fill="#fb7185" text-anchor="middle">Stat Cards</text>
  <text x="320" y="351" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">fn(data) → DOM</text>

  <rect x="162" y="320" width="100" height="40" rx="8" fill="rgba(139,92,246,0.09)" stroke="#8b5cf6" stroke-width="1"/>
  <text x="212" y="337" font-family="system-ui" font-size="10" fill="#a78bfa" text-anchor="middle">Data Cards</text>
  <text x="212" y="351" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">schema → HTML</text>

  <rect x="22" y="320" width="132" height="40" rx="8" fill="rgba(251,146,60,0.09)" stroke="#fb923c" stroke-width="1"/>
  <text x="88" y="337" font-family="system-ui" font-size="10" fill="#fb923c" text-anchor="middle">CSV Export</text>
  <text x="88" y="351" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">Blob download</text>

  <!-- Connecting lines between outputs -->
  <line x1="473" y1="340" x2="375" y2="340" stroke="#52525b" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="375" y1="340" x2="370" y2="340" stroke="#52525b" stroke-width="1" marker-end="url(#dfArr)"/>
  <line x1="269" y1="340" x2="262" y2="340" stroke="#52525b" stroke-width="1" marker-end="url(#dfArr)"/>
  <line x1="161" y1="340" x2="154" y2="340" stroke="#52525b" stroke-width="1" marker-end="url(#dfArr)"/>

  <!-- Toast notification -->
  <line x1="582" y1="290" x2="582" y2="395" stroke="#52525b" stroke-width="0.8" stroke-dasharray="4,3"/>
  <rect x="526" y="397" width="112" height="34" rx="8" fill="rgba(82,82,91,0.12)" stroke="rgba(82,82,91,0.4)" stroke-width="1"/>
  <text x="582" y="413" font-family="system-ui" font-size="10" fill="#a1a1aa" text-anchor="middle">showToast()</text>
  <text x="582" y="425" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">user feedback · 3s</text>

  <!-- updateMapMarkers also triggered -->
  <line x1="642" y1="262" x2="700" y2="395" stroke="#10b981" stroke-width="0.8" stroke-dasharray="4,3" marker-end="url(#dfArrGreen)"/>
  <rect x="672" y="397" width="126" height="34" rx="8" fill="rgba(16,185,129,0.08)" stroke="rgba(16,185,129,0.3)" stroke-width="1"/>
  <text x="735" y="413" font-family="system-ui" font-size="10" fill="#34d399" text-anchor="middle">updateMapMarkers()</text>
  <text x="735" y="425" font-family="monospace" font-size="8.5" fill="#52525b" text-anchor="middle">clear + re-plot</text>
</svg>
